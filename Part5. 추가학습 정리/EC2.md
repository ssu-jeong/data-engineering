# EC2

---

## EC2 (Amazon Elastic Compute Cloud)

- Amazon Elastic Compute Cloud(Amazon EC2)

    - AWS 컴퓨팅 서비스 중 하나
        
        - EC2 - 확장 가능한 서버(컴퓨터) 제공

        - Elastic Beanstalk - PaaS 형태의 서비스 제공

        - Lambda - severless 컴퓨팅 서비스 제공

    - Amazon EC2를 사용하면 하드웨어에 선투자할 필요가 없어 더 빠르게 애플리케이션을 개발, 배포 가능

    - 원하는 만큼 **가상서버(=인스턴스 instance)**를 구축하고 보안 및 네트워크 구성과 스토리지 관리가능

    - 또한 요구사항이나 갑작스러운 인기 증대 등 변동 사항에 다라 신속하게 규모를 확장하거나 축소할 수 있어 서버트래픽 예측 필요성이 줄어듬

- 특징

    - 컴퓨팅 요구사항의 변화에 따라 컴퓨팅 파워 조정 가능.

    - 새로운 서버 인스턴스 확보 및 부팅시간을 몇분으로 단축가능

    - 실제로 사용한 용량만큼만 지불 가능 (요금제 선택에 다라 낭비할 수 도 있음)

    - Linux/Windows 중 선택 가능 

    - 안정성을 위해 여러 AWS 리전과 가용 영역에 걸쳐 배포

- 간단히 보는 EC2 제공 기능

    - **인스턴스**: 가상 컴퓨팅 환경

    - **Amazon 머신 이미지(AMI)**: 서버에 필요한 운영체제와 여러 소프트웨어들이 적절히 구성된 상태로 제공되는 템플릿으로 인스턴스를 쉽게 만들 수 있다.

    - **인스턴스 유형(Types)**: 인스턴스를 위한 CPU, 메모리, 스토리지, 네트워킹 용량의 여러가지 구성 제공

    - **키페어**: 인스턴스 로그인 정보 보호(AWS는 퍼블릭 키를 저장하고 사용자는 개인 키를 안전한 장소에 보관하는 방식)

    - **인스턴스 스토어 볼륨**: 임시 데이터를 저장하는 스토리지 볼륨으로 인스턴스 중단, 최대 절전 모드로 전환 또는 종료시 삭제됨

    - **Amazon Elastic Block Store(Amazon EBS)**: Amazon EBS 볼륨을 사용해 영구 스토리지 볼륨에 데이터 저장

    - **리전 및 가용영역**: 인스턴스와 Amazon EBS 볼륨 등의 리소스를 다른 물리적 장소에서 액세스

    - **보안그룹**: 인스턴스에 연결할 수 있는 프로토콜, 포트, 소스 IP 범위를 지정하는 방화벽 기능

    - **탄력적 IP 주소(EIP)**: 동적 클라우드 컴퓨팅을 위한 고정 IPv4 주소 

    - **태그**: 사용자가 생성하여 Amazon EC2 리소스에 할당할 수 있는 메타데이터

    - **Virtual Private Clouds(VPC)**: AWS 클라우드에서는 논리적으로 격리되어 있지만 원할 때마다 고객의 네트워크와 간편히 연결할 수 있는 가상 네트워크

---

### 인스턴스 유형

- 인스턴스 유형에 따라 인스턴스에 사용되는 호스트 컴퓨터의 하드웨어가 결정

- 각 인스턴스 유형은 서로 다른 컴퓨팅, 메모리, 스토리지 용향을 제공하는데 이 용량에 따라 서로 다른 인스턴스 패밀리로 분류

- 인스턴스에서 실행하려는 애플리케이션 또는 소프트웨어의 요구 사항에 따라 인스턴스 유형을 선택

![images_swhan9404_post_5892c676-5b3d-43f3-b7bb-b2d19abccbfa_image-20210610014400498](https://user-images.githubusercontent.com/86764734/165676912-5c124df4-a0ad-4d34-8a09-65a36a195f70.png)

###### 인스턴스 구입 옵션

- **온디맨드 인스턴스(기본값)**: 시작하는 인스턴스에 대한 비용을 초 단위로 지불

- **Savings Plans**: 1년 또는 3년 기간 동안 시간당 USD로 일관된 컴퓨팅 사용량을 약정하여 비용을 절감할 수 있다.

- **예약 인스턴스(RI)**: 1년 또는 3년 기간동안 인스턴스 유형 또는 지역을 포함해 일관된 인스턴스 구성을 약정하여 비용을 절감할 수 있다.

- **스팟 인스턴스**: 경매단위, 미사용 EC2 인스턴스를 요청하여 비용을 대폭 줄일 수 있다.

- **전용 호스트**: 인스턴스 실행을 전담하는 실제 호스트 비용을 지불하여, 기존의 소켓, 코어 또는 VM소프트웨어별 라이선스를 가져와 비용을 절감

- **전용 인스턴스**: 단일 테넌트 하드웨어에서 실행되는 인스턴스 비용을 시간 단위로 지불

- **용량 예약**: 원하는 기간 동아 ㄴ특정 가용 영역의 EC2 인스턴스에 대해 용량을 예약

### AMI(Amazon Machin Image)

- Amazon 머신 이미지(AMI)는 소프트웨어 구성이 기재된 템플릿

    - 예: 운영 체제, 애플리케이션 서버, 애플리케이션

- AMI에서 인스턴스를 바로 시작할 수 있는데 이는 AMI의 사본으로 클라우드에서 실행되는 가상서버

    - 한 AMI로 여러 인스턴스를 실행할 수 있다. 

![images_swhan9404_post_7722f839-f48b-4f71-8753-6c2d97f9215a_architecture_ami_instance](https://user-images.githubusercontent.com/86764734/165677506-0337a28e-3822-46ec-94ce-64b48352f083.png)

---

### 종료와 중지

- 인스턴스 종료와 중지는 다름 **둘의 차이를 확실히 구분하자!!**

- 인스턴스 수명주기

|인스턴스 상태|설명|사용 요금|
|---|---|---|---
|pending|running 상태로 될 준비 인스턴스를 처음 시작하거나 stopped 상태의 인스턴스를 다시 시작하면 pending 상태가 됨.|미청구|
|running|인스턴스를 실행하고 사용할 준비|청구|
|stopping|인스턴스가 중지 또는 중지-최대 절전 모드로 전환할 준비|중지 준비 중인 경우 미청구/ 최대 절전 모드로 전환 준비중인 경우 청구|
|stopped|인스턴스가 종료되고 사용이 불가. 언제든 인스턴스를 다시 시작할 수 있다.|미청구|
|shutting-down|인스턴스 종료할 준비|미청구|
|terminated|인스턴스가 영구적으로 삭제되었으며 시작할 수 없다.|미청구 참고) 종료된 인스턴스에 적용되는 예약 인스턴스는 결제 옵션에 따라 기간이 종료될 때까지 요금 청구.|

![images_swhan9404_post_f6ef372f-09cc-449e-853a-6efa0406b8fe_instance_lifecycle](https://user-images.githubusercontent.com/86764734/165681035-25d7b0b7-4af1-4d7e-b1af-33aebd599607.png)

#### 인스턴스 중지

- 인스턴스를 중단하면 정상적인 실행종료 과정이 이루어지고 stopped 상태가 됨

    - 인스턴스의 모든 Amazon EBS 볼륨이 연결된 상태로 유지되므로 나중에 언제든지 다시 시작 가능.

    - 인스턴스가 중지됨 상태에 이쓴ㄴ 동안에는 추가 인스턴스 사용량에 대한 요금이 부가되지 않음

- 인스턴스가 중지인 상태에서 인스턴스 유형 변경가능

    - 인스턴스가 시작된 후 신규 인스턴스 유형에 대한 요금 부과

- 인스턴스가 중지인 상태에서 EBS 볼륨을 연결하거나 분리 가능

    - 모든 연결 Amazon EBS 루트 디바이스 사용을 비롯한 인스턴스 사용에 관련된 비용은 일반 요금이 적용

- 인스턴스로부터 AMI를 만들 수 있다.

- 인스턴스가 중지인 상태에서 커널, 램 디스크, 인스턴스 유형 변경 가능.

#### 인스턴스 종료

- 인스턴스가 종료될 때 인스턴스는 일반 종료를 수행

    - 루트 디바이스 볼륨은 기본적으로 삭제되지만 모든 연결된 Amazon EBS 볼륨은 기본적으로 유지

    - 이는 각 볼륨의 deleteOnTermination 속성 설정에 따라 결정

    - 인스턴스 자체도 삭제되므로 나중에 다시 시작할 수 없음

- 인스턴스 종료를 비활성화 하면 실수로 인스턴스를 종료하는 일을 방지할 수 있음

    - 이 경우에는 해당 인스턴스에 관련된 <disableApiTermination 속성> 을 true

    - Linux의 <shutdaow -h> 및 Windows의 <shutdown> 같은 인스턴스 실행종료 동작을 제어하려면, <instanceInitiatedShutdownBehavior> 인스턴스 속성을 <stop> 이나 <terminate> 로 적절히 설정

    - 기본 설정은 인스턴스 실행종료 시 Amazon EBS 볼륨을 루트 디바이스로 사용하는 인스턴스는 <stop> 상태, 인스턴스 스토어를 루트 디바이스로 사용하는 인스턴스는 항상 종료 상태로 변경

---

### EC2 스토리지

![images_swhan9404_post_a67d52dc-b343-45ff-97d8-8ae0beb5a19f_image-20210617232221080](https://user-images.githubusercontent.com/86764734/165685277-9142c88f-70cb-47c5-bf35-6b9fdee53e96.png)

- 스토리지의 종류

    - Block Storage

    
    - File Storage
    
    - Object Storage

- Amazon EC2는 상황에 맞춰 유연하고 비용대비 효율적이며 사용이 쉬운 데이터 스토리지 옵션을 제공

    - 각 옵션은 성능과 내구성이 조합되어 고유하게 구성

    - 스토리지 옵션은 독립적으로 또는 요구 사항에 맞춰 조합하여 사용 가능

- 제공되는 스토리지 옵션

    - Amazon Elastic Block Store

            - SSD: 작은 I/O 크기의 읽기/쓰기 작업을 자주 처리하는 트랜잭션 워크로드에 최적화

            - HDD: 주요 성능 특성이 처리량이 낻규모 스트리밍 워크로드에 최적화

        - 내구성이 있는 블록 수준 스토리지 볼륨을 제공하여 실행중인 인스턴스에 연결하는 것이 가능

        - EBS 볼륨이 인스턴스에 연결되면, 다른 물리적 하드 드라이브처럼 사용할 수 있음

        - 한 인스턴스에서 EBS 볼륨을 분리한 다음 다른 인스턴스에 연결하는 것도 가능. 인스턴스에 연결된 볼륨의 구성을 동적으로 변경할 수 있음 

        - Amazon EBS 암호화 기능을 사용하여 EBS 볼륨을 암호화된 볼륨으로 생성할 수도 있다. [Amazon EBS 암호화](https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/EBSEncryption.html)

        - EBS 볼륨의 스냅샷을 생성하여 Amazon S3에 저장하면 데이터의 백업 사본을 유지할 수 있음

            - 스냅샷에서 새 EBS 볼륨을 만든 후 다른 인스턴스에 연결할 수 있다. [Amazon Elastic Block Store](https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/AmazonEBS.html)
    
    - Amazon EC2 인스턴스 스토어

        - stop/start로 인해 하드웨어가 바뀌면 사라짐(휘발성)

        - 디스크 오류, 인스턴스 중지, 인스턴스 종료시 데이터 소실

    - Amazon EFS

        - EC2 인스턴스를 위한 완전 관리형 네트워크 파일시스템

        - EFS 파일 시스템을 만든 후 파일 시스템을 마운트하도록 인스턴스를 구성할 수 있음

        - 하나의 EFS 파일 시스템을 여러 인스턴스에서 실행하는 워크로드 및 애플리케이션에 대한 공통 데이터 소스로 사용할 수 있음

    - Amazon S3 (Simple Storage Service)

        - 웹에서 사용 가능한 오브젝트 저장소

        - Amazon S3를 활용하면 저렴하지만 신뢰성이 있는 데이터 스토리지 인프라에 엑세스할 수 있음

        - S3은 언제든지 Amazon EC2 내 또는 웹의 어디서나 원하는 데이터의 양을 저장하고 가져올수 있게 해주어 웹 규모의 컴퓨팅 작업을 쉽게 수행할 수 있도록 설계 

            - 예를 들어, Amazon S3를 활용하면 데이터 및 애플리케이션의 백업 사본을 저장할 수 있음

            - Amazon EC2 Amazon S3를 사용하여 EBS 스냅샷과 인스턴스 스토어 지원 AMI를 저장

- 스토리지 도입 시 고려할 사항들

    - 내구성 - 데이터 손실 측정

    - 가용성 - Downtime 측정

    - 보안 - at-rest와 in-transit 데이터 보안 

    - 비용 - Amount per Storage unit

    - 확장성 - 향상된 유연성, 스토리지 크기, 사용자 수

    - 성능 - 성능 매트릭(대역폭, IOPS)

    - Intergration - API 제공 여부 또는 다른 서비스와 상호 작용 가능성


- 스토리지 추가

    - AMI에서 인스턴스를 실행할 때마다 해당 인스턴스에 대한 루트 스토리지 디바이스가 생성

    - 루트 스토리지 디바이스에는 인스턴스를 부팅하기 위해 필요한 모든 정보가 포함

    - 블록 디바이스 매핑을 사용하면 AMI를 생성하거나 인스턴스를 실행할 때 루트 디바이스 볼륨과 스토리지 볼륨을 지정할 수 있음

### EBS 스냅샷

- 지정 시간 스냅샷을 만들어 Amazon S3에 EBS 볼륨의 데이터를 백업할 수 있음

    - 스냅샷은 증분식 백업이어서 마지막 스냅샷 이후 변경된 디바이스의 블록만이 저장

    - 그러면 스냅샷을 만드는 데 필요한 시간이 최소화, 데이터를 복제하지 않아 스토리지 비용 절약

    - 갹 스냅샷에는(스냅샷 생성 시점의) 데이터를 새 EBS 볼륨에 복원하는 데 필요한 모든 정보가 들어 있음

        - 스냅샷을 기반으로 EBS 볼륨을 생성하는 경우, 새 볼륨은 해당 스냅샷을 생성하는 데 사용된 원본 볼륨과 정확히 일치한다
        
        - [Amazon 스냅샷 생성](https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ebs-creating-snapshot.html)

    ![images_swhan9404_post_35328770-0f26-43e3-a833-332c8b1d576f_Untitled (9)](https://user-images.githubusercontent.com/86764734/166092438-07998b2a-5b4a-477b-a5b8-f888caa2121c.png)


### Referance

---

- [EC2 개념 정리](https://velog.io/@swhan9404/EC2-%EA%B0%9C%EB%85%90%EC%A0%95%EB%A6%AC)