## AWS Glue를 활용한 분석 Table 생성 설명

---

glue에 있는 데이터 카탈로그 기능을 통해서 어떻게 테이블을 구성하고 로우데이터를 저장하는지 실습. 


### 데이터 파이프라인의 흐름의 이해

![5-1-1](https://user-images.githubusercontent.com/86764734/155996313-83e0cb58-77e5-413c-bf49-166ac5ce5bc7.png)

우리가 첫번째로 로그데이터(브론즈데이터)를 emr의 spark를 활용해서 실버데이터 형태로 저장을 할 것이다. 

실버데이터 형태는 초기에는 rds에 저장했다가 다시 s3에 저장하는 형태로 실습

어떻게? glue의 데이터 카탈로그에 데이터를 저장하고 거기에 테이블을 정의하고 데이터를 저장하는 형태로 진행할 것이다.

![5-1-2](https://user-images.githubusercontent.com/86764734/155996401-cbbf3c8d-8a5a-49b9-a93a-4ad2d22f0d9c.png)

이렇게 생성된 실버데이터를 기준으로 다시 emr에 있는 spark을 활용해서 redshift나 rds인 mysql에 저장하는 것을 실습.

어떤 면에서 보면 athena로 조회해서 분석을 한다면 s3에 골드데이터를 저장하는 것도 고려해 볼만 하다.

초기에 거의 rds만 사용했었는데, 사실 골드데이터를 s3에 저장하겠다는 아키텍쳐를 생각하진 못했으나, 최근들어 아테나같은 것들을 사용하는 것을 보면 속도면에서도 잘 나오는 편이라 골드데이터로 s3로 만들어서 저장을하고 아테나로 분석을해도 무리가 없을 것이라고 생각된다.

![5-1-3](https://user-images.githubusercontent.com/86764734/155996656-2fa90ccf-8b60-4862-ab42-4e93001e1a5a.png)

### Hive table 만들기


일자별로 각 아파트 로그자체가 앱에서 발생하는데, 아파트 관련된 매물정보를 찾아보고 거기에 디테일하게 클릭해서 상세정보를 보게된다. 

이런 정보와 관련된 실버데이터를 생성을 해서 저장을 하는 것 까지 진행을 하겠다.  

아파트단지별 사용자 조회수를 저장고, 아파트 매물별 사용자 조회수에 대해서 저장을 해보도록 한다!

버켓에 저장되어 있는 것은 실질적으로 엡에서 발생된 로우데이터, 텍스트 데이터라고 보면 된다. 그래서 그것을 glue 카탈로그에다가 어떤 형태로 저장할 건지 정의를 하고 어디에서 저장을 할지 정의하고, 그루에 있는 메뉴를 통해 데이터 카탈로그 테이블을 생성 할 수 있다. 

생성된 테이블을 기준으로 emr에 있는 spark을 활용해서 트랜스포메이션 버켓에 저장을 해보도록 할 것이다. 

물리적으로는 여기 s3에 저장이 되지만 논리적으로는 테이블형테의 데이터를 가지고 분석을 진행하면 된다.

![5-1-4](https://user-images.githubusercontent.com/86764734/155996792-dec8d9dc-8f7d-4ba3-bbd0-3ce26cbc6ede.png)