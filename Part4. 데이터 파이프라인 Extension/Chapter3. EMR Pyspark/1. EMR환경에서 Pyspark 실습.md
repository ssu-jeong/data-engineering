## EMR환경에서 Pyspark 실습

---

이번시간에는 emr에서 pyspark 실습! 
최근에 pyspark이나 파이썬을 통해서 분석하는 상황이 많다.

그래서 분석가가 그런 환경에서 분석하기 위해서  어떻게 구성하면 되는지 실습진행.

많이 사용하는 jupyterlab을 사용하고 전에 실습했던 기본적인 여러 타입의 데이터를 읽어서 쓰는 그런 실습을 진행할 것!

### NOTE BOOK

왼쪽 메뉴탭에 보면 노트북이라는 것이 있다. 

노트북이 의미하는 바는 쉽게 얘기해서 에디터만 띄어줄 수 있는 환경을 구성하는 것이라 생각하면 된다. 

노트북에서는 에디터환경하고 거기에서 생성된 그 소스코드를 저장하는 것. 그 두가지 포인트로 구성한 서비스라고 생각하면 된다. 

그래서 우리가 이 노트북에서 emr클러스터를 연동해서 사용해볼 것.

![3-1](https://user-images.githubusercontent.com/86764734/162759772-d668fa0c-7eb0-4392-b6cb-81fa5c7c41de.png)


### EMR

1. 클러스터생성

    - 고급옵션으로 이동

    ![3-2](https://user-images.githubusercontent.com/86764734/162759783-d4f81c24-ac5a-47fb-9cce-01ac64a05d25.png)


    - 소프트웨어구성

        - Livy: 어플리케이션간의 인터렉티브. 어떤 서비스에서 spark에 어떤 job을 던지기 위한 어플리케이션

        - 쥬피터추가: 우리가 에디터는 쥬피터노트북을 사용할 것이기 때문에 제플린은 디져브

        - spark

        ![3-3](https://user-images.githubusercontent.com/86764734/162759794-1331fd8c-56cc-4f02-958a-900e606344dd.png)


    - 카탈로그

    ![3-4](https://user-images.githubusercontent.com/86764734/162759819-0aa3bff4-c3ec-458f-95f1-4ac431e68c29.png)


    - 클러스터 노드 와 인스턴스
        
        - 여기서 중요한 기능이 추가되었다. 과거에는 클러스터를 구성하기 위해서 적어도 마스터와 코어노드 두개는 무조건 있었어야 했는데 최근 업그레이드 된 버전에서는 코어노드를 0으로 하고 해도 된다. 이번에는 하나만 띄우기 때문에 온디멘드로 진행.
        
        - 그럼 EC2서브넷은 설정하지 않아도 되는부분???

    ![3-5](https://user-images.githubusercontent.com/86764734/162759836-f57c8c14-45f3-41a1-a37d-7f0460baa7fb.png)


    - 일반옵션
    
    클러스터 이름과 태그를 달아주자
    
       - 태그 
        → 이름을 달아줘야 ec2에 떠있는 인스턴스중에서 찾을 수 있기 때문에

    ![3-6](https://user-images.githubusercontent.com/86764734/162759848-c2e20792-d6f1-4a8a-adb1-4a1873171146.png)


    - 보안
        - 키 페어: 우리가 이전에 생성해두었던 키페어 선택해주면 된다.

    ![3-7](https://user-images.githubusercontent.com/86764734/162759862-c15fb3fa-b16a-4252-a7e5-965ab512d161.png)


    - 클러스터 생성
    
    이렇게 되면 프로비저닝을 통해서 클러스터가 뜰 것.

    ![3-8](https://user-images.githubusercontent.com/86764734/162759872-39e28efe-a8f8-4281-b2d7-4e8deb09e780.png)


    - 구성세부정보
    
    우리가 띄워놓은 어플리케이션이 보인다.

    ![3-9](https://user-images.githubusercontent.com/86764734/162759878-09866969-c52a-46f8-a7de-73dc87f1c455.png)


    여기는 쉽게말해 컴퓨팅만 지원을 해줄 것!

### 노트북 생성

노트북에서는 에디터와 이 에디터로 생성된 소스에대한 관리만 할 것이다.

1. 노트북 생성

![3-10](https://user-images.githubusercontent.com/86764734/162759893-3cb9c785-68f2-4499-aefe-435570021597.png)


2. 노트북 이름 지정 및 구성
    
    이 노트북은 항상 켜있는 것이 아니라 꺼져있다가 켜졌다가를 반복할 수 있다. 
    
    여기서 직접 클러스터를 생성할 수 도 있다. 그러나 직접 생성하니까 잘 안되는 부분들이 있고 생성되는 시간이 있어서 먼저 클러스터를 생성하고 구성하는 것이 좋다. 
    
    - 이름

    ![3-12](https://user-images.githubusercontent.com/86764734/162759900-24b33347-2272-4fce-9684-3639b60b5737.png)


    - 클러스터

        - 기존클러스터 선택
            
            아까 만든 리비와 주피터노트북을 같이 띄운 대기중인 클러스터를 선택

            ![3-13](https://user-images.githubusercontent.com/86764734/162759913-817b0e59-f405-4a78-9f75-9f14ab75d936.png)


    - 노트북위치

        - 노트북의 역할 중에 소스코드 저장이라는 역할이 있다. 개인이 만약에 이런 노트북을 구성한다면 본인이 작성한 노트북을 계속 s3에 저장할 수 있는 기능이 있다.(자기 폴터 혹은 팀의 폴더를 만들어 소스를 저장할 수 있게)

    - git 레포지토리

        - 깃 같은 경우에도 연동을 해서 git에 소스코드를 저장할 수 있다. git을 통해서 하면 평생관리도 가능하기 때문에 git을 통해서 하는 게 더 좋고 용도별로 s3에 저장하는 것도 나쁘지 않다.

    - 노트북 생성완료

        - 시작이 되면 이런 워크스페이스가 생성이 될 것이다.

        - 워크스페이스가 생성이 되면, jupyterLab에서 열기 버튼이 활성화 될 것이다.

        ![3-14](https://user-images.githubusercontent.com/86764734/162759932-4832ce18-0af9-4999-a23d-72b4e3a67597.png)


최근들어서 파이썬이 많이 사용하다 보니까 pyspark에 대한 사용자가 많아졌다. 그래서 전체적 환경을 제공해주는 주피터랩을 많이 사용하기 때문에 우리가 분석가에게 연동을 해서 제공을 해주면 분석가분들이 쉽게 할 수 있다.











